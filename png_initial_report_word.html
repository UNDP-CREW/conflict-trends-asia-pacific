<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.553">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Sean Ng">
<meta name="dcterms.date" content="2024-06-13">

<title>Exploratory data analysis of Highlands Conflict Tracker</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
</style>


<script src="png_initial_report_word_files/libs/clipboard/clipboard.min.js"></script>
<script src="png_initial_report_word_files/libs/quarto-html/quarto.js"></script>
<script src="png_initial_report_word_files/libs/quarto-html/popper.min.js"></script>
<script src="png_initial_report_word_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="png_initial_report_word_files/libs/quarto-html/anchor.min.js"></script>
<link href="png_initial_report_word_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="png_initial_report_word_files/libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="png_initial_report_word_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="png_initial_report_word_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="png_initial_report_word_files/libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script src="png_initial_report_word_files/libs/kePrint-0.0.1/kePrint.js"></script>

<link href="png_initial_report_word_files/libs/lightable-0.0.1/lightable.css" rel="stylesheet">



</head>

<body class="fullcontent">

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">

<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Exploratory data analysis of Highlands Conflict Tracker</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Sean Ng </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 13, 2024</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="inspecting-the-dataset" class="level2">
<h2 class="anchored" data-anchor-id="inspecting-the-dataset">1. Inspecting the dataset</h2>
<p><br></p>
<p>The Papua New Guinea Highlands Conflict Tracker is a dataset of conflict incidents collected in Hela and Southern Highlands Provinces. The partner engaged in data collection was ICRC, but data collection has since stopped.</p>
<p>Though the catchment area is limited to Hela and Southern Highlands Provinces, the amount of data is unprecedented for Papua New Guinea, covering a total of <strong>27 years</strong>.</p>
<p>The dataset consists of <strong>149</strong> observations – each a conflict incident. Observations began in <strong>1996-01-01</strong> and lasted until <strong>2023-05-03</strong>. Reporting began to increase in volume in 2013:</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="png_initial_report_word_files/figure-html/unnamed-chunk-1-1.png" class="img-fluid figure-img" width="912"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>It is unclear if this increase in event reporting had to do with increased violence and criminality or additional resources being afforded to the partner conducting the reporting. Interestingly, the most recent spike in violence came prior to the 2022 elections. Unfortunately, there are not many points of comparison:</p>
<p>UCDP data is nationwide and goes back to <strong>1989</strong>, but it records very few incidents, and is mainly concerned with actors trying to change the government or challenge state actors. ACLED only started data collection in <strong>2021</strong>.</p>
<p>The dataset categorises incidents by their description, people and groups involved and by conflict. The tracker dataset has collected data on <strong>109 conflicts</strong>, of which <strong>32</strong> were formed of multiple incidents over multiple days. These are plotted below by their duration.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="png_initial_report_word_files/figure-html/unnamed-chunk-3-1.png" class="img-fluid figure-img" width="912"></p>
</figure>
</div>
</div>
</div>
<p><br><br><br></p>
</section>
<section id="mapping-the-data" class="level2">
<h2 class="anchored" data-anchor-id="mapping-the-data">2. Mapping the data</h2>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="png_initial_report_word_files/figure-html/unnamed-chunk-4-1.png" class="img-fluid figure-img" width="912"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>As the next part of our inspection of the dataset, we can see that the tracker’s coverage of Hela and Southern Highlands is fairly good, with the omission of the area starting at <code>143.5 -6</code> and ending at <code>144.5 -6</code>. The distribution is also commonsensical, with many conflicts arising around populated areas. There seems to be one large cluster around Koroba and Tari Poi.</p>
<p>Here is another map of the data, this time focusing on conflict status, as in the dashboard:</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="png_initial_report_word_files/figure-html/unnamed-chunk-5-1.png" class="img-fluid figure-img" width="912"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>The vast majority of the monitored conflicts that are active are in Koroba and Tari Poi, but Komo Magarima has accumulated the highest number of conflict casualties (dead and injured) in the past 10 years.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<table class="table table-striped table-hover table-sm small" data-quarto-postprocess="true">
<caption>Casualties by district and conflict status, 2014-2023</caption>
<thead>
<tr class="header">
<th style="text-align: left;" data-quarto-table-cell-role="th">province</th>
<th style="text-align: left;" data-quarto-table-cell-role="th">district</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Active</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Ceasefire</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Dormant</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Paused</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Unknown</th>
<th style="text-align: right;" data-quarto-table-cell-role="th">Total</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;">Hela Province</td>
<td style="text-align: left;">Komo Magarima District</td>
<td style="text-align: right;">188</td>
<td style="text-align: right;">1</td>
<td style="text-align: right;">52</td>
<td style="text-align: right;">128</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">374</td>
</tr>
<tr class="even">
<td style="text-align: left;">Hela Province</td>
<td style="text-align: left;">Koroba Kopiago District</td>
<td style="text-align: right;">44</td>
<td style="text-align: right;">94</td>
<td style="text-align: right;">5</td>
<td style="text-align: right;">68</td>
<td style="text-align: right;">140</td>
<td style="text-align: right;">351</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Hela Province</td>
<td style="text-align: left;">Tari Pori District</td>
<td style="text-align: right;">237</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">26</td>
<td style="text-align: right;">43</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">306</td>
</tr>
<tr class="even">
<td style="text-align: left;">Southern Highlands Province</td>
<td style="text-align: left;">Kagua Erave District</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">37</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">90</td>
<td style="text-align: right;">83</td>
<td style="text-align: right;">214</td>
</tr>
<tr class="odd">
<td style="text-align: left;">Southern Highlands Province</td>
<td style="text-align: left;">Nipa Kutubu District</td>
<td style="text-align: right;">4</td>
<td style="text-align: right;">38</td>
<td style="text-align: right;">22</td>
<td style="text-align: right;">25</td>
<td style="text-align: right;">0</td>
<td style="text-align: right;">89</td>
</tr>
<tr class="even">
<td style="text-align: left;">Total</td>
<td style="text-align: left;">-</td>
<td style="text-align: right;">477</td>
<td style="text-align: right;">170</td>
<td style="text-align: right;">105</td>
<td style="text-align: right;">354</td>
<td style="text-align: right;">228</td>
<td style="text-align: right;">1334</td>
</tr>
</tbody>
</table>


</div>
</div>
</div>
<p><br><br><br></p>
</section>
<section id="categorising-the-data" class="level2">
<h2 class="anchored" data-anchor-id="categorising-the-data">3. Categorising the data</h2>
<p><br></p>
<p>From the chart on conflict durations in <a href="https://risk-anticipation-hub.github.io/conflict-trends-asia-pacific/png_initial_report.html#inspecting-the-data">section 1</a>, the duration does not seem to be a predictor of conflict casualties. Instead, incident descriptions seems to be more useful.</p>
<p><strong>73%</strong> of casualties (dead and injured) stem from the first 5 incident descriptions, with land-related incidents forming almost half (<strong>45%</strong>) of all casualties.</p>
<p>Conflict around land is deeply connected to a number of social and economic issues, including resource allocation, mobility and connectivity as well as with social and group identities. Mitigating conflicts arising from territorial disputes is a core duty of government, not the UN. It might be more programmatically sound to support national land reform or improve surveying, development of cadastral maps and their enforcement.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="png_initial_report_word_files/figure-html/unnamed-chunk-8-1.png" class="img-fluid figure-img" width="912"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>The categorisation above, by incident description, includes several categories not normally tracked in conflict-related research. These include issues related to domestic abuse, alcohol abuse and theft.</p>
<p>The <a href="https://ourworld.unu.edu/en/examining-the-interactions-between-conflict-and-organized-crime">line</a> between criminality and conflict is not always very clear, especially when there are organised crime elements. Therefore, it is important for the PNG Country Office to determine if the various tribal and communal militias in PNG constitute a similar threat that gangs and cartels do in, say, Ecuador’s descent into gang violence.</p>
<p>Though these incident description categories do very well in providing us context to the violence, as well as insight into many triggers, these descriptions unfortunately do not describe the type of violence, making it hard to understand if there have been an escalation in tensions. For an example, let us review ACLED’s sub-event types:</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="png_initial_report_word_files/figure-html/unnamed-chunk-9-1.png" class="img-fluid figure-img" width="912"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Though ACLED does not present triggers and underlying factors to the conflict, like the tracker does, the type of violence is always clear. It would be fruitful to go back and classify incidents according to ACLED’s terminology; this is quite an interesting avenue to explore: would violence from communal militias be considered as <code>mob violence</code>, <code>attacks</code> or <code>armed clashes</code>.</p>
<p>The added value of having event types in the dataset would be easier to monitor the progression of violence, like in this [map of Myanmar], where the point where protests turned to armed clashes is very apparent.</p>
<p>Collecting much more household, clan or tribe level data like in the tracker allows for the identification of persistent flash points and the underlying issues underpinning conflict in the region (such as land disputes), but these types of conflicts and disagreements are much more stable (as root causes are often improbable to address).</p>
<p><br><br><br></p>
</section>
<section id="conflict-actors" class="level2">
<h2 class="anchored" data-anchor-id="conflict-actors">4. Conflict actors</h2>
<p><br></p>
<section id="highlands-conflict-tracker-actors" class="level3">
<h3 class="anchored" data-anchor-id="highlands-conflict-tracker-actors">4.1 Highlands conflict tracker actors</h3>
<p>Below, each conflict actor identified in the Highlands Tracker is plotted, with the number of events each was involved in on the x-axis and the number of casualties (dead and injured) that each actor was involved with on the y-axis.</p>
<p>The size of each point indicates the number of casualties and the colour, the number of LLGs (admin3) each actor was present in, indicating the size and geographic spread of each group.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="png_initial_report_word_files/figure-html/unnamed-chunk-11-1.png" class="img-fluid figure-img" width="912"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>In the upper right of the plot, we see the more prolific (in violence) communal groups. There is some overlap here with ACLED. The Linapini were also identified as a conflict actor in the ACLED dataset.</p>
<p>On the left-hand side, we see actors which have only one recorded incident, it is not currently understood how isolated these incidents are or if reporting is just incomplete.</p>
<p>Further analysis should include the types of incidents each conflict actor is most likely to engage in and from there, flesh out full profiles for each actor, including “territory”, force strength and key motivators.</p>
<p><br><br></p>
</section>
<section id="highlands-conflict-actor-network-graph" class="level3">
<h3 class="anchored" data-anchor-id="highlands-conflict-actor-network-graph">4.2 Highlands conflict actor network graph</h3>
<p>Below is a network graph of the most-commonly occurring relationships amongst conflict actors.</p>
<p>The strength of the relationship (i.e.&nbsp;how often they are involved in the same incidents) is indicated by transparency of each line and the thickness indicates the number of events where both actors were involved together.</p>
<p>We note several dyads (as they would be termed by the UCDP): the Linapini-Tipa, Aguiba-Nalipa and Hatani-Toma are all (probably) adversarial relationships and rivalries. There is also one larger cluster of tribes. However, due to the sparsity of data, a comparatively small number of events might inflate the importance of some conflicts that may have been one-time events.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="png_initial_report_word_files/figure-html/unnamed-chunk-12-1.png" class="img-fluid figure-img" width="912"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>There is much rich detail in the incidents reported in the Highlands Conflict Tracker: 168 conflict actors have been recorded between 2014 and 2023.</p>
<p><br><br><br></p>
</section>
</section>
<section id="comparisons-to-other-datasets" class="level2">
<h2 class="anchored" data-anchor-id="comparisons-to-other-datasets">5. Comparisons to other datasets</h2>
<p><br></p>
<p>Below, we plot the number of incidents reported in the tracker against those reported in ACLED’s dataset. Unfortunately, there are just not enough data points to conduct a meaningful comparison or draw any conclusions about patterns.</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="png_initial_report_word_files/figure-html/unnamed-chunk-14-1.png" class="img-fluid figure-img" width="912"></p>
</figure>
</div>
</div>
</div>
<p><br></p>
<p>Nevertheless, as touched on in the section on <a href="https://risk-anticipation-hub.github.io/conflict-trends-asia-pacific/png_initial_report.html#categorising-the-data">categorising the data</a>, there does not seem to be much overlap between the Highland Tracker and ACLED: they both do seem to be focused on slightly different things. The Highlands Tracker has a more household, clan or tribal view of things and contains crimes that would not be recorded by ACLED.</p>
<p>However, the Highlands Tracker is also missing political violence and the movements of state actors (although this absence could also indicate the weakness of the state in Southern Highlands and Hela and its inability to project power over its own territory). To get this added dimension, it should be explored whether the Highlands Tracker should be augmented with ACLED data or with data from UNDSS incident reports.</p>
<p>Relying on ACLED data in the future, to supplement the tracker, is reasonable. We note that their coverage of Papua New Guinea is increasing, making them a useful source of information in the future:</p>
<p><br></p>
<div class="cell">
<div class="cell-output-display">
<div>
<figure class="figure">
<p><img src="png_initial_report_word_files/figure-html/unnamed-chunk-15-1.png" class="img-fluid figure-img" width="912"></p>
</figure>
</div>
</div>
</div>
<p><br><br><br></p>
</section>
<section id="recommendations-and-next-steps" class="level2">
<h2 class="anchored" data-anchor-id="recommendations-and-next-steps">6. Recommendations and next steps</h2>
<p><br></p>
<ul>
<li><p>Use the file <a href="https://github.com/risk-anticipation-hub/conflict-trends-asia-pacific/blob/main/data/tracker.csv">here</a>; this is a cleaned version of the tracker. A pivoted dataset, similar to the ACLED actors-focused dataset may be found <a href="https://github.com/risk-anticipation-hub/conflict-trends-asia-pacific/blob/main/data/tracker_actors.csv">here</a>.</p></li>
<li><p>Merge back the full details of each incident back into the dataset so that more analysis may be done.</p></li>
<li><p>Reach out to UNDSS and ask for access to all their incident reports.</p></li>
</ul>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>